<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta data-n-head="true" name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="./dist/anyTouch.umd.js"></script>
    <script src="https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/3.0.0/vconsole.min.js"></script>
    <script>
        if (!!window.location.search) {
            var vConsole = new VConsole();
        }
    </script>
    <style>
        :root {
            --bg: rgb(255, 255, 255);
            --primary: rgb(189, 174, 116);
        }

        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            min-height: 100vh;
            padding: 5px 5px 30px 5px;
            overflow-x: hidden;
            background: var(--bg);
        }

        main {
            overflow-x: hidden;
            touch-action: manipulation;
            background: var(--bg);
            min-height: calc(100vh - 20px);
        }

        .text {
            margin: 0;
            font-size: 12px;
            color: var(--primary);
        }

        .circle {
            touch-action: none;
            box-sizing: content-box;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            background: rgb(0, 0, 0, 0);
            border: 50px solid rgba(189, 174, 116, 0.7);
            position: absolute;
            left: calc(50vw - 25px);
            top: calc(50vh - 25px);
        }


        .tap {
            animation: tap 500ms;
        }

        @keyframes tap {
            from {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(.9);
                opacity: .8;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }


        .doubletap {
            animation: doubletap 500ms;
        }

        @keyframes doubletap {
            from {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(.6);
            }

            to {
                transform: scaleY(1);
            }
        }

        .fixed-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            background: rgba(255, 255, 255, .7);
            width: 100%;
            box-shadow: -1px -2px 3px rgba(0, 0, 0, 0.1);
        }

        .fixed-bottom>a {
            display: inline-block;
            padding: 15px;
            color: var(--primary);
            border-right: 1px solid rgba(189, 174, 116, 0.3);
            text-decoration: none;
        }
    </style>
</head>

<body>
    <main id="app">
        <section class="fixed-bottom">
            <a href="?debug">vconsole</a>
            <a href="?">vconsole off</a>
        </section>


        <div class="circle" id="circle" ref="circle" @animationend="animationend" :class="{
            tap: 'tap' === message.type,
            doubletap: 'doubletap' === message.type,
        }" :style="{
            transform: `scale(${scale}) translate(${x/scale}px, ${y/scale}px) rotate(${angle}deg)`,
            transformOrigin: `${centerX}px//// ${centerY}px`
        }"></div>
        <!-- <p class="text">scale: {{scale}}</p>
        <p class="text">angle: {{angle}}</p> -->
        <p v-if="message.type && key != 'currentTarget'" v-for="(item, key) in message" class="text">{{key}} : {{item}}</p>
    </main>

    <script>
        let log = console.log;
        log = () => {};

        new Vue({
            el: '#app',

            data() {
                return {
                    angle: 0,
                    scale: 1,
                    x: 0,
                    y: 0,
                    centerX: 0,
                    centerY: 0,
                    message: 'AnyTouch'
                };
            },
            mounted() {
                const anyTouch = new AnyTouch(this.$refs.circle);
                console.log(anyTouch);
                // setTimeout(() => {
                //     // anyTouch.destroy();
                // }, 1000);
                this.testPan();
                /**
                 * =========================== pan ===========================
                 */
                // ['panstart', 'panmove', 'panend'].forEach(name => {
                //     anyTouch.on(name, e => {
                //         this.message = e;
                //         console.log(e.type);
                //     })
                // });


                anyTouch.on('panmove', ({
                    deltaX,
                    deltaY
                }) => {
                    console.log({
                        deltaX,
                        deltaY
                    });
                });

                anyTouch.on('pan', e => {
                    console.log(e.deltaX);
                    e.preventDefault();

                    log(`%c ${e.type} `, 'background-color:#69c;color:#fff;');
                    this.message = e;
                    this.x += e.deltaX;
                    this.y += e.deltaY;
                });

                /**
                 * =========================== press ===========================
                 */
                anyTouch.on('press', e => {
                    log(`%c ${e.type} `, 'background-color:#fa0;color:#fff;');
                    this.message = e;
                });

                anyTouch.on('pressup', e => {
                    log(`%c ${e.type} `, 'background-color:#f70;color:#fff;');
                    this.message = e;
                });

                /**
                 * =========================== tap ===========================
                 */
                anyTouch.on('tap', e => {
                    log(`%c ${e.type} `, 'background-color:#f10;color:#fff;');
                    this.message = e;
                });

                anyTouch.on('doubletap', e => {
                    log(`%c ${e.type} `, 'background-color:#9c3;color:#fff;');
                    this.message = e;
                });

                /**
                 * =========================== pinch ===========================
                 */
                ['pinchstart', 'pinchmove', 'pinchend', 'pinchin', 'pinchout'].forEach(name => {
                    anyTouch.on(name, e => {
                        this.message = e;
                        log(e.type);
                    })
                });




                anyTouch.on('pinch', e => {
                    e.preventDefault();
                    this.message = e;
                    this.scale *= e.deltaScale;
                    this.centerX = e.centerX;
                    this.centerY = e.centerY;
                    log(`%c ${e.type} `, 'background-color:#f90;color:#fff;');
                });

                /**
                 * =========================== rotate ===========================
                 */
                ['rotatestart', 'rotatemove', 'rotateend'].forEach(name => {
                    anyTouch.on(name, e => {
                        log(e.type);
                        this.message = e;
                    })
                });

                anyTouch.on('rotate', e => {
                    e.preventDefault();
                    this.message = e;
                    this.angle += e.deltaAngle;
                    this.centerX = e.centerX;
                    this.centerY = e.centerY;
                });

                /**
                 * =========================== swipe ===========================
                 */
                ['swipeup', 'swipeleft', 'swiperight', 'swipedown'].forEach(name => {
                    anyTouch.on(name, e => {
                        log(e.type);
                        // switch (name) {
                        //     case 'swipeup':
                        //         {
                        //             this.y = this.y - 200;
                        //             break;
                        //         };

                        //     case 'swipedown':
                        //         {
                        //             this.y = this.y + 200;
                        //             break;
                        //         };
                        //     case 'swipeleft':
                        //         {
                        //             this.x = this.x - 200;
                        //             break;
                        //         };

                        //     case 'swiperight':
                        //         {
                        //             this.x = this.x + 200;
                        //             break;
                        //         };
                        // };

                        this.message = e;
                    })
                });

                anyTouch.on('swipe', e => {
                    log(`%c ${e.type} `, 'background-color:#444;color:#fff;');
                    this.message = e;
                });
            },

            methods: {
                touchstart(e) {
                    // console.log('touchstart', e.touches, e.touches.length, e.changedTouches.length);
                },
                touchmove(e) {
                    // console.log('touchmove', e, e.touches.length, e.changedTouches.length);
                },
                touchend(e) {
                    // console.log('touchend', e, e.touches.length, e.changedTouches.length);
                },
                testPan() {
                    el = this.$refs.circle;
                    let x = y = 0;
                    dispatchTouchStart();
                    let timer = setInterval(() => {
                        if (x > 100) {
                            clearInterval(timer);
                            dispatchTouchEnd(100, 100);
                        } else {
                            x += 20;
                            y = x;
                            dispatchTouchMove(x, y);
                        }
                    }, 100)

                    function dispatchTouchStart() {
                        let event1 = new Event('touchstart', {});
                        event1.touches = event1.changedTouches = [{
                            clientX: 0,
                            clientY: 0,
                        }];
                        el.dispatchEvent(event1);
                    }

                    function dispatchTouchMove(x, y) {
                        let event2 = new Event('touchmove', {});
                        event2.touches = event2.changedTouches = [{
                            clientX: x,
                            clientY: y
                        }];
                        el.dispatchEvent(event2);
                    };

                    function dispatchTouchEnd(x, y) {
                        let event3 = new Event('touchend', {});
                        event3.touches = event3.changedTouches = [{
                            clientX: x,
                            clientY: y
                        }];
                        el.dispatchEvent(event3);
                    }
                },

                animationend() {
                    // this.message = {};
                },

                tap() {
                    log('native tap')
                }
            }
        });
    </script>
</body>

</html>